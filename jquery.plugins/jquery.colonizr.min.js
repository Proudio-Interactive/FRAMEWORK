/* =============================================================
 *
 * jQuery colonizr V0.9.7 - Molokoloco 2013 - Copyleft
 * "In-between titles Multicols paragraphes" (Bootstrap-like plugin)
 *
 * Blog post : http://www.b2bweb.fr/molokoloco/jquery-colonize-plugin-in-between-titles-multicols-paragraphes-with-css3/
 * Live fiddle demo : http://jsfiddle.net/molokoloco/Ra288/
 * Github :
 *   - https://github.com/molokoloco/FRAMEWORK/blob/master/jquery.plugins/jquery.colonizr.js
 *   - https://github.com/molokoloco/FRAMEWORK/blob/master/jquery.plugins/jquery.colonizr.min.js
 *   - https://github.com/molokoloco/FRAMEWORK/blob/master/jquery.plugins/jquery.colonizr.css
 *
 * ============================================================== */

if(!("requestAnimationFrame"in window)){for(var lastTime=0,vendors=["webkit","moz","ms","o"],x=0;x<vendors.length&&!window.requestAnimationFrame;++x)window.requestAnimationFrame=window[vendors[x]+"RequestAnimationFrame"];"requestAnimationFrame"in window||(window.requestAnimationFrame=function(d,f){var h=(new Date).getTime(),a=Math.max(0,16-(h-lastTime)),e=window.setTimeout(function(){d(h+a)},a);lastTime=h+a;return e})}
!function(d){function f(a,e){this.options=d.extend(!0,{},d.fn.colonizr.defaults,"object"==typeof e&&e||{});this.$container=d(a);this.wrapper='<div class="'+this.options.css+'"/>';this.cWidth;this.intentNextP;this.lineMinHeight;this.maxHeight;this.chaptersTotal;this.refresh()}f.prototype={constructor:f,colsExtractor:function(a,e){for(var b=e.next(),c=[],f=!1,k=0,g=0;b;)b.is(this.options.chapters)?b=null:b.is(this.options.take)?(c.push(b),b=b.next()):(b.length&&(e=b),b=b.next(),b.length&&(f=!0),b=null);
if(c.length)for(var b=0,l=c.length;b<l;b++)g+=c[b].data("h");if(c.length&&g>this.lineMinHeight){g=d(this.wrapper);b=0;for(l=c.length;b<l;b++)1>k&&"&nbsp;"==c[b].html()||(k+=c[b].data("h"),g.append(c[b].detach()),c[b+1]&&this.maxHeight<=k+c[b+1].outerHeight()&&(g.insertAfter(e),e=g,k=0,g=d(this.wrapper)));g.insertAfter(e)}f?this.colsExtractor(a,e.next()):a+1==this.chaptersTotal&&this.$container.trigger("finish")},cleanColumns:function(){var a=this.$container.find("."+this.options.css);if(a.length){var e=
that.$container.parent(),b=this.$container.prev();this.$container.detach();a.each(function(){var a=d(this);d(a.html()).insertBefore(a);a.remove()});b.length?this.$container.insertAfter(b):this.$container.appendTo(e)}},refresh:function(){this.cleanColumns();var a=this,e=a.$container.find(a.options.chapters),b=a.$container.parent(),c=a.$container.prev();a.chaptersTotal=e.length;a.cWidth=a.$container.width();a.maxHeight=a.options.maxHeight;a.intentNextP=0;a.lineMinHeight=0;1>a.options.maxHeight&&(a.maxHeight=
Math.max(80,0.8*d(window).height()));var f=d("<p>A</p>").appendTo(a.$container);a.lineMinHeight=f.outerHeight()*a.options.minLine;f.remove();a.$container.on("finish",function(){c.length?a.$container.insertAfter(c):a.$container.appendTo(b)});e.each(function(b,e){for(var c=d(e).next();c.length;)c.is(a.options.chapters)?c=[]:(c.length&&c.is(a.options.take)&&c.data("h",c.outerHeight()),c.length&&(c=c.next()))});a.$container=a.$container.detach();e.each(function(b,c){a.colsExtractor(b,d(c))})}};var h=
d.fn.colonizr;d.fn.colonizr=function(a){return this.each(function(){var e=d(this),b=e.data("colonizr");b||e.data("colonizr",b=new f(this,a));if("string"==typeof a)b[a]()})};d.fn.colonizr.Constructor=f;d.fn.colonizr.defaults={chapters:"h1,h2,h3,h4,h5,h6",take:"p",css:"multiplecolumns",minLine:2,maxHeight:null};d.fn.colonizr.noConflict=function(){d.fn.colonizr=h;return this};d(window).on("load",function(){d('[data-colonizr="true"]').each(function(){var a=d(this);a.colonizr(a.data())})})}(window.jQuery);