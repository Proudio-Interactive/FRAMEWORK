// jQuery scrollView V0.8.4 : Viewport scroll and screen vertical helper - @molokoloco 2013 - Copyleft
// One view for each screen that user need to scroll to get to the bottom of the HTML view
// Live fiddle : http://jsfiddle.net/molokoloco/XK3t5/
// Github : https://github.com/molokoloco/FRAMEWORK/blob/master/jquery.plugins/jquery.scrollScreen.js
//          https://github.com/molokoloco/FRAMEWORK/blob/master/jquery.plugins/jquery.scrollScreen.css
// Infos : http://www.b2bweb.fr/molokoloco/jquery-scrollview-viewport-scroll-and-screen-vertical-helper

(function(b,q,y){var r=b(q),s=b(y),B=b("body"),n="html,body,document",p=b(),t="",z=!1;b(n).each(function(c){c=parseInt(b(this).scrollTop(),10);b(this).scrollTop(c+1);if(r.scrollTop()==c+1)return n=this.nodeName.toLowerCase(),!1});var p=b(n),k=function(){return q.location.hash||""},u=function(){return parseInt(p.scrollTop()||r.scrollTop(),10)},v=function(c){z=!0;var b=360+0.42*Math.abs(c-u());2222<b&&(b=0);p.stop(!0,!1).animate({scrollTop:c},{duration:b,easing:"easeOutCubic",complete:function(){var c=
t;c&&k()!=c&&(q.location.hash=c);t="";z=!1}})};b.easing.jswing=b.easing.swing;b.extend(b.easing,{def:"easeOutCubic",swing:function(c,l,d,h,e){return b.easing[b.easing.def](c,l,d,h,e)},easeInQuad:function(c,b,d,h,e){return h*(b/=e)*b+d},easeOutCubic:function(c,b,d,h,e){return h*((b=b/e-1)*b*b+1)+d}});b.fn.scrollToMe=function(c){return this.each(function(){c&&(t=c);v(parseInt(b(this).offset().top,10))})};b.fn.scrollScreen=function(c){if(!0==B.data("scrollScreen"))return this;B.data("scrollScreen",!0);
c=b.extend(!0,{},b.fn.scrollScreen.defaults,"object"==typeof c&&c);var l=b(this),d=b('<div class="'+c.scrollScreen+'">1</div>').appendTo(l),h=b('<div class="'+c.scrollScreenZone+'" title="Pour naviguer d\'\u00e9cran en \u00e9cran..."></div>').appendTo(l),e=null,g=null,f=r.height(),m=s.height(),n=f*(f/m),w=1+Math.floor(s.height()/f),p=-Math.floor(d.height()-d.height()/3),t=f-d.height(),C=function(){d.css({left:s.width()-d.width()-3})},D=function(){c.debug&&console.log("mouseIsMoveViewsClear()");e&&
clearTimeout(A);z?e=setTimeout(D,2500):(e=null,d.removeClass("current"),h.attr("title",""),x(u()))},E=function(a){c.debug&&console.log("moveViews(ascPos)",a);a=a||u();a+=p;a=Math.max(a,0);a=Math.min(a,t);var b=1+Math.floor(w*(a/f));d.css({top:a}).text(b);c.checkHash&&k()!="#screen_"+b&&(a="#screen_"+b)&&k()!=a&&(q.location.hash=a)},A=function(a){c.debug&&console.log("mouseIsMoveViews(event)",a.clientY);e?(clearTimeout(e),e=null):d.addClass("current");E(a.clientY)},x=function(a){c.debug&&console.log("setCurrentViewport(scrollTop)",
a);a=((a||u())+f)/m;E((f-n)*a)},l=function(a){c.debug&&console.log("viewportClick(event)",a);var b=0,b=10>a.clientY?0:a.clientY>f-10?m:m*((a.clientY+p)/f);v(b);return!1};C();c.debug&&console.log("createViewport()");h.on("click touchend",l).on("dblclick",function(a){c.debug&&console.log("viewportDbClick()");v(1);return!1}).on("mousemove",A).on("mouseout",function(a){c.debug&&console.log("mouseIsOutViews(event)",a);e&&clearTimeout(A);e=setTimeout(D,2500)});d.on("click touchend",l);x();var y=function(){c.debug&&
console.log("scrollRefreshEvent()");g=null;d.removeClass("current")},G=function(a){c.debug&&console.log("resizeRefreshEvent()");f=r.height();m=s.height();n=f*(f/m);w=Math.ceil(s.height()/f);1>=w?d.hide():d.show();C();x();c.checkHash&&(g=setTimeout(function(a){g=null;F(a)},1E3,a||k()))};r.on("scroll",function(a){g&&clearTimeout(g);g=setTimeout(y,600);x();d.addClass("current")}).on("resize",function(a){g&&clearTimeout(g);g=setTimeout(G,360,k())});G();var F=function(a){c.debug&&console.log("checkHash(hash)",
a,"getHash()",k());if(a=a||k())if(a=a.split("screen_"),1<parseInt(a[1],10)){a=a[1];c.debug&&console.log("moveToViewport(view)",a);var b=0,b=a==w?m:a*f;v(b)}};c.checkHash&&F();return this};b.fn.scrollScreen.defaults={debug:"console"in q&&!1,checkHash:!1,scrollScreenZone:"scrollScreenZone",scrollScreen:"scrollScreen"}})(jQuery,window,document);